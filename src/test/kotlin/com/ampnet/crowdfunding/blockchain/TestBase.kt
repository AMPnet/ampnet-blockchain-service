package com.ampnet.crowdfunding.blockchain

import com.ampnet.crowdfunding.blockchain.config.ApplicationProperties
import com.ampnet.crowdfunding.blockchain.config.DatabaseCleanerService
import com.ampnet.crowdfunding.blockchain.service.BlockchainService
import com.ampnet.crowdfunding.proto.BlockchainServiceGrpc
import io.grpc.ManagedChannel
import io.grpc.Server
import io.grpc.inprocess.InProcessChannelBuilder
import io.grpc.inprocess.InProcessServerBuilder
import org.assertj.core.api.Assertions
import org.junit.jupiter.api.AfterEach
import org.junit.jupiter.api.BeforeEach
import org.springframework.beans.factory.annotation.Autowired
import org.springframework.boot.test.context.SpringBootTest
import org.springframework.test.context.ActiveProfiles
import org.web3j.abi.FunctionEncoder
import org.web3j.abi.datatypes.Address
import org.web3j.abi.datatypes.Function
import org.web3j.crypto.Credentials
import org.web3j.crypto.RawTransaction
import org.web3j.crypto.TransactionEncoder
import org.web3j.protocol.Web3j
import org.web3j.protocol.core.DefaultBlockParameterName
import org.web3j.utils.Numeric
import java.math.BigInteger
import java.util.concurrent.TimeUnit

@SpringBootTest
@ActiveProfiles("test")
abstract class TestBase {

    class Accounts {
        /*
            mnemonic: cable high nice seek trash erase garage already fork fog manual series express clay easily pelican imitate detect gaze level protect agree stem area
            address: 0x1dee7718aaca3ce44c010b87efcdc71477714637
         */
        val coopOwner = Credentials.create("0x4843d7e2658482c2cab8cf79576e4112d156fd87dda1e08468b51fe34fd08569")

        /*
            mnemonic: rent tongue caught column obtain genre person bus carry extend twenty fiction
            address: 0x43b0d9b605e68a0c50dc436757a86c82d97787cc
         */
        val eurOwner = Credentials.create("0xc0c85e6b373d090048676f0c82542cb3bb6793491450f478b147614262718cdd")

        /*
            mnemonic: sketch sentence arrive fringe square jar birth ribbon priority coast pear comic
            address: 0x722f586a528da40924cef8372946ad2dded2a8be
         */
        val alice = Credentials.create("0xe8c7e2bdd82569189d73cb618391973c8f52d8ba651446a00a87cc67c8219781")

        /*
            mnemonic: hybrid check vessel more afford mistake fever edge permit fitness hard hero
            address: 0x89451cfe47ec2e68a82b5ea4b06eb711c0f6351f
         */
        val bob = Credentials.create("0x215d6c308a70b5b74081ec71f7d67495b0c3c88bf0ba119b8eeb022cf2c20251")

        /*
            menmonic: match green raise tomorrow mirror galaxy twist taste hurry vessel hurt harsh
            address: 0x4cfceb385aaaa34c1a453608d885465eeb205e42
         */
        val jane = Credentials.create("0xe57787b6142f659d759fcbe2ecda7e49f105fd61b10f73d980ab1964aef71132")
    }

    data class TestProject(
        val minUserInvestment: Long,
        val maxUserInvesment: Long,
        val invesmentCap: Long
    )

    val accounts = Accounts()
    val testProject = TestProject(
            1000L,  // 10 EUR min investment per user
            10000L, // 100 EUR max investment per user
            10000L // 100 EUR investment cap
    )

    val coopBytecode = "0x6080604052336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a361403f806100cf6000396000f3006080604052600436106100c5576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630d5ce8d5146100ca578063144fa6d71461010d5780634905507a146101505780634ee4df2714610167578063715018a6146101aa5780638da5cb5b146101c15780638f32d59b146102185780639754a3a8146102475780639ec92cce146102b3578063d0ed7b911461030e578063efeb5f1f14610369578063f2fde38b146103ac578063fc0c546a146103ef575b600080fd5b3480156100d657600080fd5b5061010b600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610446565b005b34801561011957600080fd5b5061014e600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610633565b005b34801561015c57600080fd5b506101656106f3565b005b34801561017357600080fd5b506101a8600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610908565b005b3480156101b657600080fd5b506101bf610af5565b005b3480156101cd57600080fd5b506101d6610c30565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561022457600080fd5b5061022d610c59565b604051808215151515815260200191505060405180910390f35b34801561025357600080fd5b5061025c610cb0565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b8381101561029f578082015181840152602081019050610284565b505050509050019250505060405180910390f35b3480156102bf57600080fd5b506102f4600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610d3e565b604051808215151515815260200191505060405180910390f35b34801561031a57600080fd5b5061034f600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610d94565b604051808215151515815260200191505060405180910390f35b34801561037557600080fd5b506103aa600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610dea565b005b3480156103b857600080fd5b506103ed600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610f03565b005b3480156103fb57600080fd5b50610404610f8b565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b600033905061045481610d3e565b80156104fb57508073ffffffffffffffffffffffffffffffffffffffff1663ce6955186040518163ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401602060405180830381600087803b1580156104bf57600080fd5b505af11580156104d3573d6000803e3d6000fd5b505050506040513d60208110156104e957600080fd5b81019080805190602001909291905050505b1515610595576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260358152602001807f50726f7669646564206f7267616e697a6174696f6e206973206e6f742061707081526020017f726f76656420627920436f6f70657261746976652e000000000000000000000081525060400191505060405180910390fd5b60018060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055508173ffffffffffffffffffffffffffffffffffffffff167f9ae14270d96a1e7eba0486d8c340a42fde018a5db0da570f36686e7dd4818f8d60405160405180910390a25050565b61063b610c59565b15156106af576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252600d8152602001807f494e56414c4944204f574e45520000000000000000000000000000000000000081525060200191505060405180910390fd5b80600460006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b60006106fe33610d94565b1515610772576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260128152602001807f57616c6c6574206e6f74206163746976652e000000000000000000000000000081525060200191505060405180910390fd5b333061077c6110ab565b808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200192505050604051809103906000f080158015610801573d6000803e3d6000fd5b50905060038190806001815401808255809150509060018203906000526020600020016000909192909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550506001600260008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055508073ffffffffffffffffffffffffffffffffffffffff167ff84dfefd1424c476705a9a5ce3238cf6b203e946990646666c5bec8bc8043b2a60405160405180910390a250565b600033905061091681610d3e565b80156109bd57508073ffffffffffffffffffffffffffffffffffffffff1663ce6955186040518163ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401602060405180830381600087803b15801561098157600080fd5b505af1158015610995573d6000803e3d6000fd5b505050506040513d60208110156109ab57600080fd5b81019080805190602001909291905050505b1515610a57576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260358152602001807f50726f7669646564206f7267616e697a6174696f6e206973206e6f742061707081526020017f726f76656420627920436f6f70657261746976652e000000000000000000000081525060400191505060405180910390fd5b60018060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055508173ffffffffffffffffffffffffffffffffffffffff167f9ae14270d96a1e7eba0486d8c340a42fde018a5db0da570f36686e7dd4818f8d60405160405180910390a25050565b610afd610c59565b1515610b71576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252600d8152602001807f494e56414c4944204f574e45520000000000000000000000000000000000000081525060200191505060405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff166000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a360008060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614905090565b60606003805480602002602001604051908101604052809291908181526020018280548015610d3457602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019060010190808311610cea575b5050505050905090565b6000600260008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff169050919050565b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff169050919050565b610df2610c59565b1515610e66576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252600d8152602001807f494e56414c4944204f574e45520000000000000000000000000000000000000081525060200191505060405180910390fd5b60018060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055508073ffffffffffffffffffffffffffffffffffffffff167f9ae14270d96a1e7eba0486d8c340a42fde018a5db0da570f36686e7dd4818f8d60405160405180910390a250565b610f0b610c59565b1515610f7f576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252600d8152602001807f494e56414c4944204f574e45520000000000000000000000000000000000000081525060200191505060405180910390fd5b610f8881610fb1565b50565b600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614151515610fed57600080fd5b8073ffffffffffffffffffffffffffffffffffffffff166000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a3806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b604051612f58806110bc83390190560060806040526000600360146101000a81548160ff02191690831515021790555034801561002b57600080fd5b50604051604080612f588339810180604052810190808051906020019092919080519060200190929190505050816000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505050612e6e806100ea6000396000f300608060405260043610610099576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630f15f4c01461009e57806324d7806c146100b5578063574d7722146101105780639eab525314610151578063c1075329146101bd578063ca6d56dc1461020a578063ce6955181461024d578063dcc601281461027c578063e608c730146102e8575b600080fd5b3480156100aa57600080fd5b506100b361033f565b005b3480156100c157600080fd5b506100f6600480360381019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506105e6565b604051808215151515815260200191505060405180910390f35b34801561011c57600080fd5b5061014f60048036038101908080359060200190929190803590602001909291908035906020019092919050505061063f565b005b34801561015d57600080fd5b50610166610988565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b838110156101a957808201518184015260208101905061018e565b505050509050019250505060405180910390f35b3480156101c957600080fd5b50610208600480360381019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050610a16565b005b34801561021657600080fd5b5061024b600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610d06565b005b34801561025957600080fd5b50610262611093565b604051808215151515815260200191505060405180910390f35b34801561028857600080fd5b506102916110a6565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b838110156102d45780820151818401526020810190506102b9565b505050509050019250505060405180910390f35b3480156102f457600080fd5b506102fd611134565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16638da5cb5b6040518163ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401602060405180830381600087803b1580156103c557600080fd5b505af11580156103d9573d6000803e3d6000fd5b505050506040513d60208110156103ef57600080fd5b810190808051906020019092919050505073ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156104c8576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260368152602001807f496c6c6567616c20616374696f6e2e204f6e6c7920436f6f706572617469766581526020017f2063616e206d616b65207468697320616374696f6e210000000000000000000081525060400191505060405180910390fd5b6001600360146101000a81548160ff021916908315150217905550600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16634ee4df27306040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050600060405180830381600087803b1580156105a057600080fd5b505af11580156105b4573d6000803e3d6000fd5b505050507f1ba3c1298bb0842d0645ac140ca4f02f26b32a4b1e49899a93bcb09bf5b9ae8d60405160405180910390a1565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16149050919050565b600061064a336105e6565b15156106e4576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252602b8152602001807f496c6c6567616c20616374696f6e2e204d757374206265206f7267616e697a6181526020017f74696f6e2061646d696e2100000000000000000000000000000000000000000081525060400191505060405180910390fd5b600360149054906101000a900460ff16151561078e576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260298152602001807f4f7267616e697a6174696f6e206e6f7420766572696669656420627920436f6f81526020017f706572617469766521000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b8383833061079a61115a565b808581526020018481526020018381526020018273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001945050505050604051809103906000f080158015610801573d6000803e3d6000fd5b50905060028190806001815401808255809150509060018203906000526020600020016000909192909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16630d5ce8d5826040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050600060405180830381600087803b15801561092757600080fd5b505af115801561093b573d6000803e3d6000fd5b505050508073ffffffffffffffffffffffffffffffffffffffff167ff4ddd4a01f076935f5636676ad00367a07143bf5c2d36bdb7522b7c37a0e01e660405160405180910390a250505050565b60606001805480602002602001604051908101604052809291908181526020018280548015610a0c57602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190600101908083116109c2575b5050505050905090565b610a1f336105e6565b1515610ab9576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252602b8152602001807f496c6c6567616c20616374696f6e2e204d757374206265206f7267616e697a6181526020017f74696f6e2061646d696e2100000000000000000000000000000000000000000081525060400191505060405180910390fd5b600360149054906101000a900460ff161515610b63576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260298152602001807f4f7267616e697a6174696f6e206e6f7420766572696669656420627920436f6f81526020017f706572617469766521000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fc0c546a6040518163ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401602060405180830381600087803b158015610be957600080fd5b505af1158015610bfd573d6000803e3d6000fd5b505050506040513d6020811015610c1357600080fd5b810190808051906020019092919050505073ffffffffffffffffffffffffffffffffffffffff1663095ea7b383836040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182815260200192505050602060405180830381600087803b158015610cc657600080fd5b505af1158015610cda573d6000803e3d6000fd5b505050506040513d6020811015610cf057600080fd5b8101908080519060200190929190505050505050565b610d0f336105e6565b1515610da9576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252602b8152602001807f496c6c6567616c20616374696f6e2e204d757374206265206f7267616e697a6181526020017f74696f6e2061646d696e2100000000000000000000000000000000000000000081525060400191505060405180910390fd5b600360149054906101000a900460ff161515610e53576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260298152602001807f4f7267616e697a6174696f6e206e6f7420766572696669656420627920436f6f81526020017f706572617469766521000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b80600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0ed7b91826040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b158015610f1157600080fd5b505af1158015610f25573d6000803e3d6000fd5b505050506040513d6020811015610f3b57600080fd5b81019080805190602001909291905050501515610fe6576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252602c8152602001807f57616c6c6574206e6f74207265676973746572656420617320436f6f7065726181526020017f74697665206d656d6265722e000000000000000000000000000000000000000081525060400191505060405180910390fd5b60018290806001815401808255809150509060018203906000526020600020016000909192909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550508173ffffffffffffffffffffffffffffffffffffffff167fb251eb052afc73ffd02ffe85ad79990a8b3fed60d76dbc2fa2fdd7123dffd91460405160405180910390a25050565b600360149054906101000a900460ff1681565b6060600280548060200260200160405190810160405280929190818152602001828054801561112a57602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190600101908083116110e0575b5050505050905090565b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b604051611cd88061116b833901905600608060405234801561001057600080fd5b50604051608080611cd88339810180604052810190808051906020019092919080519060200190929190805190602001909291908051906020019092919050505083600081905550826001819055508160028190555080600960006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050505050611c1e806100ba6000396000f3006080604052600436106100af576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063285ed0d3146100b4578063352f1d23146100cb578063427c0c7f146100f65780638383fadc146101215780638f82e5ae1461014e57806391cd71631461017d57806396b98862146101a8578063c5e690ce146101ff578063e3affda31461022e578063e8b5e51f14610259578063f3fef3a314610270575b600080fd5b3480156100c057600080fd5b506100c96102bd565b005b3480156100d757600080fd5b506100e06108de565b6040518082815260200191505060405180910390f35b34801561010257600080fd5b5061010b6108e4565b6040518082815260200191505060405180910390f35b34801561012d57600080fd5b5061014c600480360381019080803590602001909291905050506108ea565b005b34801561015a57600080fd5b50610163610cf1565b604051808215151515815260200191505060405180910390f35b34801561018957600080fd5b50610192610cff565b6040518082815260200191505060405180910390f35b3480156101b457600080fd5b506101e9600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610d05565b6040518082815260200191505060405180910390f35b34801561020b57600080fd5b50610214610d1d565b604051808215151515815260200191505060405180910390f35b34801561023a57600080fd5b50610243610d30565b6040518082815260200191505060405180910390f35b34801561026557600080fd5b5061026e610d36565b005b34801561027c57600080fd5b506102bb600480360381019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291908035906020019092919050505061159a565b005b600080600080600080600080600080600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166324d7806c336040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b15801561038957600080fd5b505af115801561039d573d6000803e3d6000fd5b505050506040513d60208110156103b357600080fd5b8101908080519060200190929190505050151561045e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252602f8152602001807f46756e6374696f6e2061636365737369626c65206f6e6c7920746f206f72676181526020017f6e697a6174696f6e2061646d696e21000000000000000000000000000000000081525060400191505060405180910390fd5b610466610cf1565b1515610526576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260428152602001807f46756e6374696f6e2061636365737369626c65206f6e6c79207768656e20707281526020017f6f6a656374277320696e766573746d656e74206361702069732072656163686581526020017f642e00000000000000000000000000000000000000000000000000000000000081525060600191505060405180910390fd5b600880549050995060018a039850600160326006540103975060065496508789106105515787610553565b885b9550600554945088861415610592576000600460006101000a81548160ff0219169083151502179055506000600581905550600060068190555061059d565b600186016006819055505b8693505b85841115156108d2576008848154811015156105b957fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169250600760008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054915060035482860281151561063757fe5b049050600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663e608c7306040518163ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401602060405180830381600087803b1580156106c057600080fd5b505af11580156106d4573d6000803e3d6000fd5b505050506040513d60208110156106ea57600080fd5b810190808051906020019092919050505073ffffffffffffffffffffffffffffffffffffffff1663fc0c546a6040518163ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401602060405180830381600087803b15801561075e57600080fd5b505af1158015610772573d6000803e3d6000fd5b505050506040513d602081101561078857600080fd5b810190808051906020019092919050505073ffffffffffffffffffffffffffffffffffffffff1663a9059cbb84836040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182815260200192505050602060405180830381600087803b15801561083b57600080fd5b505af115801561084f573d6000803e3d6000fd5b505050506040513d602081101561086557600080fd5b8101908080519060200190929190505050508273ffffffffffffffffffffffffffffffffffffffff167f7a950abcc7cb40599ffd4d9de0ddcd963ad346f49093efbf4305304a564c473d826040518082815260200191505060405180910390a283806001019450506105a1565b50505050505050505050565b60015481565b60035481565b600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166324d7806c336040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b1580156109a757600080fd5b505af11580156109bb573d6000803e3d6000fd5b505050506040513d60208110156109d157600080fd5b81019080805190602001909291905050501515610a7c576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252602f8152602001807f46756e6374696f6e2061636365737369626c65206f6e6c7920746f206f72676181526020017f6e697a6174696f6e2061646d696e21000000000000000000000000000000000081525060400191505060405180910390fd5b610a84610cf1565b1515610b44576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260428152602001807f46756e6374696f6e2061636365737369626c65206f6e6c79207768656e20707281526020017f6f6a656374277320696e766573746d656e74206361702069732072656163686581526020017f642e00000000000000000000000000000000000000000000000000000000000081525060600191505060405180910390fd5b600081111515610bbc576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601a8152602001807f526576656e7565206973207a65726f2e2041626f7274696e672e00000000000081525060200191505060405180910390fd5b600460009054906101000a900460ff16151515610c8d576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260488152602001807f46696e6973682063757272656e7420726576656e75652073686172652070617981526020017f6f75742070726f63657373206265666f7265207374617274696e6720616e6f7481526020017f686572206f6e652e00000000000000000000000000000000000000000000000081525060600191505060405180910390fd5b806005819055506001600460006101000a81548160ff02191690831515021790555060006006819055507f98ec1298c6fc386f59d14a04df4b8dfc6d07082b57a22441c71f4e8d6c3c5daa816040518082815260200191505060405180910390a150565b600060025460035414905090565b60005481565b60076020528060005260406000206000915090505481565b600460009054906101000a900460ff1681565b60025481565b6000806000806000600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663e608c7306040518163ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401602060405180830381600087803b158015610dc457600080fd5b505af1158015610dd8573d6000803e3d6000fd5b505050506040513d6020811015610dee57600080fd5b810190808051906020019092919050505073ffffffffffffffffffffffffffffffffffffffff1663fc0c546a6040518163ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401602060405180830381600087803b158015610e6257600080fd5b505af1158015610e76573d6000803e3d6000fd5b505050506040513d6020811015610e8c57600080fd5b810190808051906020019092919050505094508473ffffffffffffffffffffffffffffffffffffffff1663dd62ed3e33306040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200192505050602060405180830381600087803b158015610f6e57600080fd5b505af1158015610f82573d6000803e3d6000fd5b505050506040513d6020811015610f9857600080fd5b81019080805190602001909291905050509350600760003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054925083830191508360035401905060025460035410151561109a576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260328152602001807f43616e206e6f7420696e766573742c2070726f6a65637420616c72656164792081526020017f636f6d706c6574656c792066756e6465642e000000000000000000000000000081525060400191505060405180910390fd5b60008414151515611113576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601b8152602001807f43616e206e6f7420696e76657374207a65726f20746f6b656e7321000000000081525060200191505060405180910390fd5b60005482111515156111d9576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260568152602001807f55736572277320696e766573746d656e742077696c6c2073757270617373206d81526020017f6178696d756d207065722d7573657220696e766573746d656e7420666f72207481526020017f6869732070726f6a6563742e2041626f7274696e672e0000000000000000000081525060600191505060405180910390fd5b600154821015151561129f576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260608152602001807f55736572277320696e766573746d656e7420646f6573206e6f74206d6565742081526020017f7265717569726564206d696e696d756d207065722d7573657220696e7665737481526020017f6d656e7420666f7220746869732070726f6a6563742e2041626f7274696e672e81525060600191505060405180910390fd5b6002548111151515611365576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252605f8152602001807f55736572277320696e766573746d656e742077696c6c206d616b6520746f746181526020017f6c2066756e6473207261697365642067726561746572207468616e2070726f6a81526020017f656374277320696e766573746d656e74206361702e2041626f7274696e672e0081525060600191505060405180910390fd5b8473ffffffffffffffffffffffffffffffffffffffff166323b872dd3330876040518463ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019350505050602060405180830381600087803b15801561143c57600080fd5b505af1158015611450573d6000803e3d6000fd5b505050506040513d602081101561146657600080fd5b8101908080519060200190929190505050508360036000828254019250508190555083600760003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254019250508190555060008314156115455760083390806001815401808255809150509060018203906000526020600020016000909192909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550505b3373ffffffffffffffffffffffffffffffffffffffff167fe9c4cc8e534d6e220d278c0fe4988bd7c8e0f3731587e2f70f0e8c0c693009ae856040518082815260200191505060405180910390a25050505050565b600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166324d7806c336040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b15801561165757600080fd5b505af115801561166b573d6000803e3d6000fd5b505050506040513d602081101561168157600080fd5b8101908080519060200190929190505050151561172c576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252602f8152602001807f46756e6374696f6e2061636365737369626c65206f6e6c7920746f206f72676181526020017f6e697a6174696f6e2061646d696e21000000000000000000000000000000000081525060400191505060405180910390fd5b611734610cf1565b15156117f4576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260428152602001807f46756e6374696f6e2061636365737369626c65206f6e6c79207768656e20707281526020017f6f6a656374277320696e766573746d656e74206361702069732072656163686581526020017f642e00000000000000000000000000000000000000000000000000000000000081525060600191505060405180910390fd5b600081111515611892576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260278152602001807f43616e206e6f74207769746864726177207a65726f20746f6b656e732e20416281526020017f6f7274696e672e0000000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b600460009054906101000a900460ff16151515611963576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252604d8152602001807f43616e206e6f74207769746864726177206d6f6e65792066726f6d2070726f6a81526020017f656374207768696c6520726576656e7565207368617265207061796f7574206981526020017f7320696e2070726f636573732e0000000000000000000000000000000000000081525060600191505060405180910390fd5b600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663e608c7306040518163ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401602060405180830381600087803b1580156119e957600080fd5b505af11580156119fd573d6000803e3d6000fd5b505050506040513d6020811015611a1357600080fd5b810190808051906020019092919050505073ffffffffffffffffffffffffffffffffffffffff1663fc0c546a6040518163ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401602060405180830381600087803b158015611a8757600080fd5b505af1158015611a9b573d6000803e3d6000fd5b505050506040513d6020811015611ab157600080fd5b810190808051906020019092919050505073ffffffffffffffffffffffffffffffffffffffff1663095ea7b383836040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182815260200192505050602060405180830381600087803b158015611b6457600080fd5b505af1158015611b78573d6000803e3d6000fd5b505050506040513d6020811015611b8e57600080fd5b8101908080519060200190929190505050503373ffffffffffffffffffffffffffffffffffffffff167fcc68764a9cdb21dabbd704e0ec115ded5e23b12274ac49792015b422353d1bd1826040518082815260200191505060405180910390a250505600a165627a7a72305820672ffa5d54bd7fda8a6c7732bb6f3836443b2ab6d5f695a1fa9895b390fdd19e0029a165627a7a7230582018f1ff5c5e60634bde072c51ea27f7cdb15c7f743dd31a1e0a49cffa4c2bd7510029a165627a7a723058208874ad7c100058c680d5f2aa1f2fd11f9caf36286d8570b014b465759d5f22d60029"
    val eurBytecode = "0x60806040523480156200001157600080fd5b5060405160208062002ff1833981018060405281019080805190602001909291905050506040805190810160405280600b81526020017f4469676974616c204555520000000000000000000000000000000000000000008152506040805190810160405280600381526020017f455552000000000000000000000000000000000000000000000000000000000081525060128260039080519060200190620000bb92919062000317565b508160049080519060200190620000d492919062000317565b5080600560006101000a81548160ff021916908360ff1602179055505050506200010d3362000155640100000000026401000000009004565b80600760006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050620003c6565b62000179816006620001bf6401000000000262002a90179091906401000000009004565b8073ffffffffffffffffffffffffffffffffffffffff167f6ae172837ea30b801fbfcdd4108aa1d5bf8ff775444fd70256b44e6bf3dfc3f660405160405180910390a250565b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614151515620001fc57600080fd5b62000217828262000282640100000000026401000000009004565b1515156200022457600080fd5b60018260000160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055505050565b60008073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1614151515620002c057600080fd5b8260000160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16905092915050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200035a57805160ff19168380011785556200038b565b828001600101855582156200038b579182015b828111156200038a5782518255916020019190600101906200036d565b5b5090506200039a91906200039e565b5090565b620003c391905b80821115620003bf576000816000905550600101620003a5565b5090565b90565b612c1b80620003d66000396000f3006080604052600436106100f1576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806306fdde03146100f6578063095ea7b31461018657806318160ddd146101eb57806323b872dd14610216578063313ce5671461029b57806339509351146102cc57806340c10f191461033157806342966c681461039657806370a08231146103c357806379cc67901461041a57806395d89b4114610467578063983b2d56146104f7578063986502751461053a578063a457c2d714610551578063a9059cbb146105b6578063aa271e1a1461061b578063dd62ed3e14610676575b600080fd5b34801561010257600080fd5b5061010b6106ed565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561014b578082015181840152602081019050610130565b50505050905090810190601f1680156101785780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561019257600080fd5b506101d1600480360381019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291908035906020019092919050505061078f565b604051808215151515815260200191505060405180910390f35b3480156101f757600080fd5b50610200610ad9565b6040518082815260200191505060405180910390f35b34801561022257600080fd5b50610281600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050610ae3565b604051808215151515815260200191505060405180910390f35b3480156102a757600080fd5b506102b0610fd3565b604051808260ff1660ff16815260200191505060405180910390f35b3480156102d857600080fd5b50610317600480360381019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050610fea565b604051808215151515815260200191505060405180910390f35b34801561033d57600080fd5b5061037c600480360381019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291908035906020019092919050505061120f565b604051808215151515815260200191505060405180910390f35b3480156103a257600080fd5b506103c1600480360381019080803590602001909291905050506113dd565b005b3480156103cf57600080fd5b50610404600480360381019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506113e2565b6040518082815260200191505060405180910390f35b34801561042657600080fd5b50610465600480360381019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291908035906020019092919050505061142a565b005b34801561047357600080fd5b5061047c611438565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156104bc5780820151818401526020810190506104a1565b50505050905090810190601f1680156104e95780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561050357600080fd5b50610538600480360381019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506114da565b005b34801561054657600080fd5b5061054f6114fa565b005b34801561055d57600080fd5b5061059c600480360381019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050611505565b604051808215151515815260200191505060405180910390f35b3480156105c257600080fd5b50610601600480360381019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291908035906020019092919050505061172a565b604051808215151515815260200191505060405180910390f35b34801561062757600080fd5b5061065c600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050611a74565b604051808215151515815260200191505060405180910390f35b34801561068257600080fd5b506106d7600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050611a91565b6040518082815260200191505060405180910390f35b606060038054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156107855780601f1061075a57610100808354040283529160200191610785565b820191906000526020600020905b81548152906001019060200180831161076857829003601f168201915b5050505050905090565b600082600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0ed7b91826040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b15801561084f57600080fd5b505af1158015610863573d6000803e3d6000fd5b505050506040513d602081101561087957600080fd5b81019080805190602001909291905050508061089a575061089981611a74565b5b1515610934576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260228152602001807f4e6f742061207265676973746572656420436f6f70657261746976652075736581526020017f722e00000000000000000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0ed7b91336040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b1580156109f157600080fd5b505af1158015610a05573d6000803e3d6000fd5b505050506040513d6020811015610a1b57600080fd5b81019080805190602001909291905050501515610ac6576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260228152602001807f4e6f742061207265676973746572656420436f6f70657261746976652075736581526020017f722e00000000000000000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b610ad08484611b18565b91505092915050565b6000600254905090565b600083600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0ed7b91826040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b158015610ba357600080fd5b505af1158015610bb7573d6000803e3d6000fd5b505050506040513d6020811015610bcd57600080fd5b810190808051906020019092919050505080610bee5750610bed81611a74565b5b1515610c88576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260228152602001807f4e6f742061207265676973746572656420436f6f70657261746976652075736581526020017f722e00000000000000000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b83600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0ed7b91826040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b158015610d4657600080fd5b505af1158015610d5a573d6000803e3d6000fd5b505050506040513d6020811015610d7057600080fd5b810190808051906020019092919050505080610d915750610d9081611a74565b5b1515610e2b576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260228152602001807f4e6f742061207265676973746572656420436f6f70657261746976652075736581526020017f722e00000000000000000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0ed7b91336040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b158015610ee857600080fd5b505af1158015610efc573d6000803e3d6000fd5b505050506040513d6020811015610f1257600080fd5b81019080805190602001909291905050501515610fbd576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260228152602001807f4e6f742061207265676973746572656420436f6f70657261746976652075736581526020017f722e00000000000000000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b610fc8868686611c45565b925050509392505050565b6000600560009054906101000a900460ff16905090565b6000600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0ed7b91336040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b1580156110a957600080fd5b505af11580156110bd573d6000803e3d6000fd5b505050506040513d60208110156110d357600080fd5b8101908080519060200190929190505050151561117e576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260228152602001807f4e6f742061207265676973746572656420436f6f70657261746976652075736581526020017f722e00000000000000000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b8261118881611a74565b15156111fc576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260118152602001807f4e6f7420746f6b656e206973737565722100000000000000000000000000000081525060200191505060405180910390fd5b6112068484611df7565b91505092915050565b600061121a33611a74565b151561122557600080fd5b82600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0ed7b91826040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b1580156112e357600080fd5b505af11580156112f7573d6000803e3d6000fd5b505050506040513d602081101561130d57600080fd5b81019080805190602001909291905050508061132e575061132d81611a74565b5b15156113c8576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260228152602001807f4e6f742061207265676973746572656420436f6f70657261746976652075736581526020017f722e00000000000000000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b6113d2848461202e565b600191505092915050565b600080fd5b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b611434828261216c565b5050565b606060048054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156114d05780601f106114a5576101008083540402835291602001916114d0565b820191906000526020600020905b8154815290600101906020018083116114b357829003601f168201915b5050505050905090565b6114e333611a74565b15156114ee57600080fd5b6114f781612314565b50565b6115033361236e565b565b6000600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0ed7b91336040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b1580156115c457600080fd5b505af11580156115d8573d6000803e3d6000fd5b505050506040513d60208110156115ee57600080fd5b81019080805190602001909291905050501515611699576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260228152602001807f4e6f742061207265676973746572656420436f6f70657261746976652075736581526020017f722e00000000000000000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b826116a381611a74565b1515611717576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260118152602001807f4e6f7420746f6b656e206973737565722100000000000000000000000000000081525060200191505060405180910390fd5b61172184846123c8565b91505092915050565b600082600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0ed7b91826040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b1580156117ea57600080fd5b505af11580156117fe573d6000803e3d6000fd5b505050506040513d602081101561181457600080fd5b810190808051906020019092919050505080611835575061183481611a74565b5b15156118cf576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260228152602001807f4e6f742061207265676973746572656420436f6f70657261746976652075736581526020017f722e00000000000000000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0ed7b91336040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b15801561198c57600080fd5b505af11580156119a0573d6000803e3d6000fd5b505050506040513d60208110156119b657600080fd5b81019080805190602001909291905050501515611a61576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260228152602001807f4e6f742061207265676973746572656420436f6f70657261746976652075736581526020017f722e00000000000000000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b611a6b84846125ff565b91505092915050565b6000611a8a82600661261690919063ffffffff16565b9050919050565b6000600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b60008073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1614151515611b5557600080fd5b81600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925846040518082815260200191505060405180910390a36001905092915050565b6000600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020548211151515611cd257600080fd5b611d6182600160008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546126aa90919063ffffffff16565b600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550611dec8484846126cb565b600190509392505050565b60008073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1614151515611e3457600080fd5b611ec382600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546128e490919063ffffffff16565b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546040518082815260200191505060405180910390a36001905092915050565b60008273ffffffffffffffffffffffffffffffffffffffff161415151561205457600080fd5b612069816002546128e490919063ffffffff16565b6002819055506120c0816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546128e490919063ffffffff16565b6000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040518082815260200191505060405180910390a35050565b600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205481111515156121f757600080fd5b61228681600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546126aa90919063ffffffff16565b600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055506123108282612905565b5050565b612328816006612a9090919063ffffffff16565b8073ffffffffffffffffffffffffffffffffffffffff167f6ae172837ea30b801fbfcdd4108aa1d5bf8ff775444fd70256b44e6bf3dfc3f660405160405180910390a250565b612382816006612b4090919063ffffffff16565b8073ffffffffffffffffffffffffffffffffffffffff167fe94479a9f7e1952cc78f2d6baab678adc1b772d936c6583def489e524cb6669260405160405180910390a250565b60008073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161415151561240557600080fd5b61249482600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546126aa90919063ffffffff16565b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546040518082815260200191505060405180910390a36001905092915050565b600061260c3384846126cb565b6001905092915050565b60008073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415151561265357600080fd5b8260000160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16905092915050565b6000808383111515156126bc57600080fd5b82840390508091505092915050565b6000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054811115151561271857600080fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415151561275457600080fd5b6127a5816000808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546126aa90919063ffffffff16565b6000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550612838816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546128e490919063ffffffff16565b6000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040518082815260200191505060405180910390a3505050565b60008082840190508381101515156128fb57600080fd5b8091505092915050565b60008273ffffffffffffffffffffffffffffffffffffffff161415151561292b57600080fd5b6000808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054811115151561297857600080fd5b61298d816002546126aa90919063ffffffff16565b6002819055506129e4816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546126aa90919063ffffffff16565b6000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040518082815260200191505060405180910390a35050565b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614151515612acc57600080fd5b612ad68282612616565b151515612ae257600080fd5b60018260000160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055505050565b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614151515612b7c57600080fd5b612b868282612616565b1515612b9157600080fd5b60008260000160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff02191690831515021790555050505600a165627a7a72305820a974ce158caa145cddd188c3de4fe58212d01aefb8f2c6e42eca93f2c23c322e0029"

    lateinit var server: Server
    lateinit var channel: ManagedChannel
    lateinit var grpc: BlockchainServiceGrpc.BlockchainServiceBlockingStub

    @Autowired
    lateinit var web3j: Web3j

    @Autowired
    lateinit var applicationProperties: ApplicationProperties

    @Autowired
    lateinit var blockchainService: BlockchainService

    @Autowired
    lateinit var databaseCleanerService: DatabaseCleanerService

    @BeforeEach
    fun setUp() {
        startGrpc()

        deployCoopContract()
        deployEurContract()
        injectEurAddressToCoop()

        databaseCleanerService.deleteAll()
    }

    @AfterEach
    fun tearDown() {
        shutdownGrpc()
    }

    protected fun suppose(@Suppress("UNUSED_PARAMETER") description: String, function: () -> Unit) {
        function.invoke()
    }

    protected fun verify(@Suppress("UNUSED_PARAMETER") description: String, function: () -> Unit) {
        function.invoke()
    }

    private fun startGrpc() {
        val serverName = InProcessServerBuilder.generateName()
        server = InProcessServerBuilder.forName(serverName)
                .directExecutor()
                .addService(blockchainService)
                .build()
                .start()
        channel = InProcessChannelBuilder.forName(serverName)
                .directExecutor()
                .usePlaintext()
                .build()
        grpc = BlockchainServiceGrpc.newBlockingStub(channel)
    }

    private fun shutdownGrpc() {
        channel.shutdown()
        server.shutdown()

        try {
            Assertions.assertThat(
                    channel.awaitTermination(5, TimeUnit.SECONDS)
            ).isTrue()

            Assertions.assertThat(
                    server.awaitTermination(5, TimeUnit.SECONDS)
            ).isTrue()
        } finally {
            channel.shutdownNow()
            server.shutdownNow()
        }
    }

    private fun deployCoopContract() {
        val nonce = web3j.ethGetTransactionCount(
                accounts.coopOwner.address,
                DefaultBlockParameterName.LATEST
        ).send().transactionCount

        val gasPrice = web3j.ethGasPrice().send().gasPrice
        val tx = RawTransaction.createContractTransaction(
                nonce,
                gasPrice,
                BigInteger.valueOf(6_000_000),
                BigInteger.ZERO,
                coopBytecode
        )

        val signedTx = TransactionEncoder.signMessage(tx, accounts.coopOwner)
        val txHash = web3j.ethSendRawTransaction(Numeric.toHexString(signedTx)).send().transactionHash
        val receipt = web3j.ethGetTransactionReceipt(txHash).send()
        val address = receipt.transactionReceipt.get().contractAddress

        applicationProperties.contracts.coopAddress = address
    }

    private fun deployEurContract() {
        val nonce = web3j.ethGetTransactionCount(
                accounts.eurOwner.address,
                DefaultBlockParameterName.LATEST
        ).send().transactionCount

        val gasPrice = web3j.ethGasPrice().send().gasPrice
        val constructor = FunctionEncoder.encodeConstructor(
                listOf(Address(applicationProperties.contracts.coopAddress))
        )
        val deployTx = RawTransaction.createContractTransaction(
                nonce,
                gasPrice,
                BigInteger.valueOf(6_000_000),
                BigInteger.ZERO,
                eurBytecode + constructor
        )

        val deployTxSigned = TransactionEncoder.signMessage(deployTx, accounts.eurOwner)
        val txHash = web3j.ethSendRawTransaction(Numeric.toHexString(deployTxSigned)).send().transactionHash
        val receipt = web3j.ethGetTransactionReceipt(txHash).send()
        val address = receipt.transactionReceipt.get().contractAddress

        applicationProperties.contracts.eurAddress = address
    }

    private fun injectEurAddressToCoop() {
        val nonce = web3j.ethGetTransactionCount(
                accounts.coopOwner.address,
                DefaultBlockParameterName.LATEST
        ).send().transactionCount

        val gasPrice = web3j.ethGasPrice().send().gasPrice
        val gasLimit = BigInteger.valueOf(1_000_000)

        val ampnetAddress = applicationProperties.contracts.coopAddress
        val eurAddress = applicationProperties.contracts.eurAddress

        val setEurFunction = FunctionEncoder.encode(
                Function(
                        "setToken",
                        listOf(Address(eurAddress)),
                        emptyList()
                )
        )

        val tx = RawTransaction.createTransaction(
                nonce,
                gasPrice,
                gasLimit,
                ampnetAddress,
                setEurFunction
        )
        web3j.ethSendRawTransaction(
                Numeric.toHexString(
                        TransactionEncoder.signMessage(tx, accounts.coopOwner)
                )
        ).send()
    }
}
